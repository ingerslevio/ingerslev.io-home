---
import type { Language } from "../types/race";

// Detect current locale from URL
const language: Language = Astro.params.language as Language;
---

<div class="language-switcher-container">
  <div class="language-switcher">
    <button
      class={`lang-button ${language === "en" ? "active" : ""}`}
      data-lang="en"
    >
      EN
    </button>
    <button
      class={`lang-button ${language === "da" ? "active" : ""}`}
      data-lang="da"
    >
      DA
    </button>
  </div>
</div>

<style>
  .language-switcher-container {
    display: flex;
    justify-content: center;
  }
  .language-switcher {
    display: flex;
    gap: 0.25rem;
    background-color: #fff;
    border: 1px solid #cccccc;
    padding: 0.25rem;
    border-radius: 8px;
    margin-bottom: 2rem;
  }

  .lang-button {
    padding: 0.5rem 1rem;
    border: none;
    background: transparent;
    color: #a0a0a0;
    font-weight: 600;
    font-size: 0.875rem;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .lang-button:hover {
    background-color: #333333;
    color: #cccccc;
  }

  .lang-button.active {
    background-color: #aaa;
    color: #ffffff;
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
  }
</style>

<script>
  // Simple language switching for Astro i18n
  document.addEventListener("DOMContentLoaded", () => {
    const languageSwitcher = document.querySelector(".language-switcher");
    if (languageSwitcher) {
      languageSwitcher.addEventListener("click", (event) => {
        const target = event.target as HTMLElement;
        if (target.classList.contains("lang-button")) {
          const newLang = target.textContent?.trim().toLowerCase();
          const currentPath = window.location.pathname;

          if (newLang === "da") {
            // Switch to Danish
            if (currentPath.startsWith("/en/")) {
              window.location.href = currentPath.replace("/en/", "/da/");
            } else if (currentPath === "/mentions") {
              window.location.href = "/da/mentions";
            } else {
              window.location.href = "/da" + currentPath;
            }
          } else if (newLang === "en") {
            // Switch to English
            if (currentPath.startsWith("/da/")) {
              window.location.href = currentPath.replace("/da/", "/en/");
            } else if (currentPath === "/mentions") {
              window.location.href = "/en/mentions";
            } else {
              window.location.href = "/en" + currentPath;
            }
          }
        }
      });
    }
  });
</script>
