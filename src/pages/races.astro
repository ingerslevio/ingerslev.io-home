---
import Layout from "../layouts/Layout.astro";
import RaceCard from "../components/RaceCard.astro";
import LanguageSwitcher from "../components/LanguageSwitcher.astro";
import { getUpcomingRaces, getPastRaces } from "../data/races";
import type { Language } from "../types/race";

const upcomingRaces = await getUpcomingRaces();
const pastRaces = await getPastRaces();
const language: Language = "da";
---

<Layout>
  <div class="races-container">
    <header class="races-header">
      <h1>Løb</h1>
      <p class="subtitle">
        Min løbende rejse gennem tidligere og fremtidige løb
      </p>

      <div class="language-switcher-container">
        <LanguageSwitcher />
      </div>
    </header>

    <div class="races-content">
      <section class="upcoming-races">
        <h2 id="upcoming-title">Kommende Løb</h2>
        {
          upcomingRaces.length > 0 ? (
            <div class="races-grid">
              {upcomingRaces.map((race) => (
                <RaceCard race={race} language={language} />
              ))}
            </div>
          ) : (
            <div class="empty-state">
              <p id="upcoming-empty">Ingen kommende løb planlagt.</p>
            </div>
          )
        }
      </section>

      <section class="past-races">
        <h2 id="past-title">Tidligere Løb</h2>
        {
          pastRaces.length > 0 ? (
            <div class="races-grid">
              {pastRaces.map((race) => (
                <RaceCard race={race} language={language} />
              ))}
            </div>
          ) : (
            <div class="empty-state">
              <p id="past-empty">Ingen tidligere løb registreret.</p>
            </div>
          )
        }
      </section>
    </div>
  </div>
</Layout>

<style>
  .races-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
    background-color: #0a0a0a;
  }

  .races-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .races-header h1 {
    font-size: 3rem;
    font-weight: 800;
    color: #ffffff;
    margin: 0 0 1rem 0;
    background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle {
    font-size: 1.25rem;
    color: #a0a0a0;
    margin: 0 0 2rem 0;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .language-switcher-container {
    display: flex;
    justify-content: center;
  }

  .races-content {
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }

  section h2 {
    font-size: 2rem;
    font-weight: 700;
    color: #ffffff;
    margin: 0 0 1.5rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid #00d4ff;
    display: inline-block;
  }

  .races-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    background-color: #1a1a1a;
    border-radius: 12px;
    border: 2px dashed #333333;
  }

  .empty-state p {
    color: #a0a0a0;
    font-size: 1.125rem;
    margin: 0;
  }

  @media (max-width: 768px) {
    .races-container {
      padding: 1rem;
    }

    .races-header h1 {
      font-size: 2.5rem;
    }

    .subtitle {
      font-size: 1.125rem;
    }

    section h2 {
      font-size: 1.75rem;
    }
  }

  @media (max-width: 480px) {
    .races-header h1 {
      font-size: 2rem;
    }

    .subtitle {
      font-size: 1rem;
    }

    section h2 {
      font-size: 1.5rem;
    }
  }
</style>

<script>
  // Simple language switching for Astro i18n
  document.addEventListener("DOMContentLoaded", () => {
    const languageSwitcher = document.querySelector(".language-switcher");
    if (languageSwitcher) {
      languageSwitcher.addEventListener("click", (event) => {
        const target = event.target as HTMLElement;
        if (target.classList.contains("lang-button")) {
          const newLang = target.textContent?.trim().toLowerCase();
          if (newLang === "da") {
            window.location.href = "/races";
          } else if (newLang === "en") {
            window.location.href = "/en/races";
          }
        }
      });
    }
  });
</script>
